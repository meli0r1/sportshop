{% extends "base.html" %}

{% block title %}Корзина — SportShop{% endblock %}

{% block content %}
    <h1>Ваша корзина</h1>

    {% if cart_items %}
        <div class="cart-items">
            {% for item in cart_items %}
                <div class="cart-item">
                    <div class="cart-item-image">
                        {% if item.product.image %}
                            <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
                        {% else %}
                            <div class="placeholder-img">Нет фото</div>
                        {% endif %}
                    </div>
                    <div class="cart-item-info">
                        <h3>{{ item.product.name }}</h3>
                        <p class="price">{{ item.product.price }} ₽</p>
                        
                        <!-- Управление количеством -->
                        <div class="quantity-control">
                            <form method="post" action="{% url 'update_cart' item.product.id %}" style="display:inline;">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="decrease">
                                <button type="submit" class="qty-btn">−</button>
                            </form>
                            
                            <span class="qty-value">{{ item.quantity }}</span>
                            
                            <form method="post" action="{% url 'update_cart' item.product.id %}" style="display:inline;">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="increase">
                                <button type="submit" class="qty-btn">+</button>
                            </form>
                        </div>

                        <p class="item-total">Итого: {{ item.total }} ₽</p>

                        <!-- Кнопка удаления -->
                        <form method="post" action="{% url 'update_cart' item.product.id %}" class="remove-form">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="remove">
                            <button type="submit" class="btn btn-remove">Удалить</button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        </div>

        <div class="cart-summary">
            <h2>Итого: {{ total }} ₽</h2>
        </div>

        <div class="order-form">
            <h2>Оформить заказ</h2>
            <form method="post" action="{% url 'checkout' %}">
                {% csrf_token %}
                <div class="form-group">
                    <label>Имя:</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Телефон:</label>
                    <input type="tel" name="phone" required>
                </div>
                <div class="form-group">
                    <label>Адрес доставки:</label>
                    <textarea name="address" required></textarea>
                </div>
                <button type="submit" class="btn btn-checkout">Оформить заказ</button>
            </form>
        </div>
    {% else %}
        <p>Ваша корзина пуста.</p>
        <a href="{% url 'catalog' %}" class="btn">Перейти в каталог</a>
    {% endif %}
{% endblock %}