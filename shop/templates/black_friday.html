{% extends "base.html" %}

{% block title %}–ß—ë—Ä–Ω–∞—è –ø—è—Ç–Ω–∏—Ü–∞ ‚Äî NEXUS SPORT{% endblock %}

{% block content %}
    <header class="bf-header">
        <h1>üî• –ß–Å–†–ù–ê–Ø –ü–Ø–¢–ù–ò–¶–ê</h1>
        <p style="font-size:1.2em;color:var(--accent-1);">–°–∫–∏–¥–∫–∏ –¥–æ 20% –Ω–∞ –æ—Å—Ç–∞—Ç–∫–∏!</p>
        
        {% if is_active %}
            <div id="countdown" style="margin-top:15px;font-size:1.3em;font-weight:bold;"></div>
        {% else %}
            <p>–†–∞—Å–ø—Ä–æ–¥–∞–∂–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –Ω–æ–≤–æ—Å—Ç—è–º–∏!</p>
        {% endif %}
    </header>

    {% if products %}
        <div class="product-grid">
            {% for product in products %}
                <div class="product-card">
                    {% if product.image %}
                        <img src="{{ product.image.url }}" alt="{{ product.name }}">
                    {% else %}
                        <div class="placeholder-img">–ù–µ—Ç —Ñ–æ—Ç–æ</div>
                    {% endif %}
                    <h3>{{ product.name }}</h3>
                    
                    <!-- –°–∫–∏–¥–∫–∞ -->
                    {% with discount_info=product.get_discount_info %}
                        {% if discount_info.0 > 0 %}
                            <p style="color:#aaa;text-decoration:line-through;">{{ product.price }} ‚ÇΩ</p>
                            <p class="price">{{ discount_info.1 }} ‚ÇΩ</p>
                            <p style="color:var(--accent-2);font-weight:bold;">-{{ discount_info.0 }}%!</p>
                        {% endif %}
                    {% endwith %}

                    <p style="color: {% if product.stock <= 3 %}#ff5252{% else %}#66bb6a{% endif %};">
                        –û—Å—Ç–∞–ª–æ—Å—å: {{ product.stock }} —à—Ç.
                    </p>

                    <a href="{% url 'product_detail' product.id %}" class="btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å–∫–∏–¥–∫–∞–º–∏.</p>
    {% endif %}
{% endblock %}

{% block extra_js %}
<script>
    // –¢–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á—ë—Ç–∞
    {% if is_active and bf_end %}
        const countdownElement = document.getElementById('countdown');
        if (countdownElement) {
            const endTime = new Date('{{ bf_end|date:"c" }}').getTime();
            const timer = setInterval(() => {
                const now = new Date().getTime();
                const diff = endTime - now;
                if (diff < 0) {
                    clearInterval(timer);
                    countdownElement.innerHTML = '–†–∞—Å–ø—Ä–æ–¥–∞–∂–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!';
                    return;
                }
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                countdownElement.innerHTML = `–î–æ –∫–æ–Ω—Ü–∞ —Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∏: ${days}–¥ ${hours}—á ${minutes}–º`;
            }, 60000); // –æ–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
        }
    {% endif %}
</script>
{% endblock %}